using System.Collections.Generic;
using HtmlAgilityPack;

namespace RE.Core.Models
{
    public class FormCollection : Dictionary<HtmlNode, Dictionary<string, string>>
    {
        public FormCollection(HtmlDocument htmlDoc)
        {
            var forms = htmlDoc.DocumentNode.Descendants("form");
            foreach (var form in forms)
            {
                var formElement = new Dictionary<string, string>();

                var inputs = form.Descendants("input");
                foreach (var input in inputs)
                {
                    var name = input.GetAttributeValue("name", "undefined");
                    var value = input.GetAttributeValue("value", string.Empty);

                    if (!formElement.ContainsKey(name))
                    {
                        if (!name.Equals("undefined"))
                        {
                            formElement.Add(name, value);
                        }
                    }
                }

                if (!ContainsKey(form))
                {
                    Add(form, formElement);
                }
            }
        }
    }
}
